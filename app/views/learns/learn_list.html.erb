<% content_for :js do %>
  <%= javascript_import_module_tag "controllers/video_replay" %>
<% end %>

<p class="pankuzu">
  <%= link_to 'トップページ', root_path, class: 'common_a' %> >
  <% if params["type"].blank? %>
    <%= link_to '学びの資料', learns_path, class: 'common_a' %> >
  <% end %>
  学びの資料 <%= @learn_category_name %>
</p>
<div class="common_field_title">
  <h1><%= @learn_category_name %></h1>
  <div class="underline"></div>
</div>

<div class="danger_message">
  <p>注意</p>
  <p>STNのコンテンツになるので、</p>
  <p>・ファイルをSNSで共有する</p>
  <p>・動画を拡散する。(SNSも含む。)</p>
  <p>この2点をお守りください。</p><br>
  <p>上記2点を含む悪質な行為と判断した場合は損害賠償請求をさせていただく場合がございます。</p>
  <p>了承した方のみコンテンツをご覧ください。</p>
</div>

<div class="learn_detail_list">
  <% if @learn_infos.present? %>
    <% @learn_infos.each_with_index do |learn, index| %>
      <% if learn.learn_category_id == 1 && current_user&.admin_flg != 1%>
        <% can_view = task_submitted?(learn.id, current_user&.id, index + 1) %>
        <% video_class = can_view ? '' : 'not_video' %>
      <% else %>
        <% video_class = '' %>
      <% end %>
      <div class="learn_part black">
        <p class="common_size20"><%= learn.created_at.strftime('%Y/%m/%d') %></p>
        <p class="common_size16"><%= learn.name %></p>

        <div class="learn_box <%= video_class %>">
          <% if video_class == "not_video" %>
            <%= image_tag 'lock.svg' %>
          <% end %>
          <div class="learn_document_video">
            <% if learn.video_file.attached? %>
              <%= video_tag(url_for(learn.video_file), controls: true, class: 'common_box_beige common_size16', id: "learnVideo#{index}", controlsList: "nodownload") %>
            <% end %>
            <% if learn.document_file.attached? %>
              <%= link_to '資料', rails_blob_path(learn.document_file, disposition: "inline"), target: "_blank", class: 'common_box_beige common_size16' %>
            <% end %>
          </div>
        </div>

        <!-- 動画を表示するためのモーダル -->
        <div id="videoModal" class="modal">
          <span class="close">&times;</span>
          <video id="videoPlayer" controls controlsList="nodownload" style="width:100%;">
            Your browser does not support the video tag.
          </video>
        </div>
      </div>
    <% end %>
  <% else %>
    <p>まだ<%= @learn_category_name %>の資料は登録されていません。</p>
  <% end %>
</div>

<!-- ページネーションの部分は必要に応じて調整 -->
<%= paginate @learn_infos, theme: 'learn_custom_paginator' %>

<% if params["type"].blank? %>
  <div class="common_field_title">
    <h1>他カテゴリー</h1>
    <div class="underline"></div>
  </div>
  <div class="other_category">
    <p class="common_size20">他のカテゴリー</p>
    <div class="category_list">
      <% @learn_category.each do |learn_category| %>
        <%= link_to learn_category.name, learn_list_learns_path(id: learn_category), class: 'category_part common_btn_shape common_size16' %>
      <% end %>
    </div>
  </div>
<% end %>
<% if params["type"].present? %>
  <%= link_to '戻る', root_path, class: 'common_btn_beige common_btn_beige_background common_btn_content common_merge' %>
<% else %>
  <%= link_to '戻る', learns_path, class: 'common_btn_beige common_btn_beige_background common_btn_content common_merge' %>
<% end %>
